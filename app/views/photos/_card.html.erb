<div class="card mb-4 shadow-sm">
  <div class="row g-0">
    <div class="col-12 col-md-6">
      <% if photo.image.present? %>
        <%= image_tag photo.image.url, alt: photo.title, 
                      class: "photo-cover img-fluid w-100 h-100", 
                      data: { bs_toggle: "modal", bs_target: "#photoModal#{photo.id}" } %>
      <% end %>
    </div>
    <div class="col-12 col-md-6">
      <div class="card-body d-flex flex-column h-100">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <%= link_to photos_user_path(photo.user) do %>
                <% if photo.user.avatar.present? %>
                  <%= image_tag photo.user.avatar, 
                              class: "photo-user-avatar rounded-circle user-avatar-link"%>
                <% else %>
                  <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center text-white fw-bold user-avatar-link" 
                       style="width: 25px; height: 25px; font-size: 12px;">
                    <%= photo.user.first_name&.first&.upcase %><%= photo.user.last_name&.first&.upcase %>
                  </div>
                <% end %>
              <% end %>
            </div>
            <div>
              <%= link_to photos_user_path(photo.user), class: "text-decoration-none text-dark" do %>
                <p id="user-name" class="mb-0 text-nowrap fw-bold user-link"><%= photo.user.first_name %> <%= photo.user.last_name %></p>
              <% end %>
            </div>
          </div>
          <% if current_user == photo.user %>
            <%= link_to "Edit", edit_photo_path(photo), class: "btn btn-outline-primary btn-sm px-3 fw-bold rounded-pill" %>
          <% else %>
            <button class="follow-btn btn  btn-sm px-2 fw-bold rounded-pill" data-user-id="<%= photo.user.id %>">
              Follow
            </button>
          <% end %>
        </div>
        <p class="card-title mb-2 fw-bold"><%= photo.title %></p>
        <p class="card-text text-muted flex-grow-1 fs-6" ">
          <%= photo.description %>
        </p>
        <div class="d-flex align-items-center justify-content-between pt-3 border-top">
          <button class="btn btn-link p-0 text-decoration-none like-btn" data-photo-id="<%= photo.id %>">
            <i class="far fa-heart me-2"></i>
            <span class="like-count"><%= photo.likes_count || 0 %></span>
          </button>
          <small class="text-muted">
            <%= (photo.publication_date || photo.created_at).strftime("%d %b %Y") %>
          </small>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Bootstrap Modal -->
<%= render 'photos/modal', photo: photo %>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Like button functionality
    document.querySelectorAll('.like-btn').forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();

        const photoId = this.getAttribute('data-photo-id');
        const heartIcon = this.querySelector('.fa-heart');
        const likeCount = this.querySelector('.like-count');
        const isLiked = this.classList.contains('liked');

        // Toggle like state
        if (isLiked) {
          this.classList.remove('liked');
          heartIcon.classList.remove('fas');
          heartIcon.classList.add('far');
          likeCount.textContent = parseInt(likeCount.textContent) - 1;
        } else {
          this.classList.add('liked');
          heartIcon.classList.remove('far');
          heartIcon.classList.add('fas');
          likeCount.textContent = parseInt(likeCount.textContent) + 1;
        }
        // AJAX call
      });
    });

    // Follow button functionality
    document.querySelectorAll('.follow-btn').forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();

        const userId = this.getAttribute('data-user-id');
        const isFollowing = this.classList.contains('following');

        if (isFollowing) {
          this.classList.remove('following');
          this.textContent = 'Follow';
        } else {
          this.classList.add('following');
          this.textContent = 'Following';
        }

        // Here you would typically make an AJAX call to update the server
        // fetch(`/users/${userId}/follow`, { method: 'POST' })
      });
    });
  });
</script>
